<!DOCTYPE html>
<html>
<head>
    <title>cms631: personal stories</title>
    <link rel="stylesheet" type="text/css" href="leaflet/leaflet.css" />
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/jquery"></script>
    <script type='text/javascript' src='leaflet/leaflet.js'></script>
    <script src="thing.js" type="text/javascript"></script>
    <style>
        body {
            overflow: hidden;
        }

        #view {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        #map {
            position: absolute;
            top: 0;
            right: 0px;
            bottom: 0;
            left: 600px;

            transition-property: all;
            transition-duration: 1.0s;
        }

        #map.hidden {
            top: -200%;
        }

        #iframe {
            z-index: 1000;
            background-color: white;
            position: absolute;
            top: -220px;
            left: 0;
            bottom: 0px;
            width: 600px;
        }

        #iframe iframe {
            width: 100%;
            height: 115%;
        }

        #wordcloud {
            position: absolute;
            top: 200%;
            left: 620px;
            right: 0;
            height: 100%;

            transition-property: all;
            transition-duration: 1.0s;
        }

        #wordcloud.visible {
            top: 0px;
        }
    </style>
</head>
<body>
    <div id="view">
        <div id="iframe">
            <button v-if="cloudy" style="position:absolute;top:230px;right:10px;" @click='dosomething'>X</button>
            <iframe id="viewer" src="welcome.html"></iframe>
        </div>
        <div id='map' v-bind:class="{ hidden: cloudy }"></div>
        <div id='wordcloud' v-bind:class="{ visible: cloudy }">
            <h1>Here's what other people in this neighborhood are saying:</h1>
            <img :src="image_url" style="position:absolute;top:50%;left:50%;transform: translate(-50%,-40%); width:640px;"/>
        </div>
    </div>
    <script>
        var story_urls = [
            "http://goboston2030.org/mashs-trip/", //Roxbury
            "http://goboston2030.org/jeffreys-trip/", //Allston
            "http://goboston2030.org/jenns-trip/", //South End to Brookline, here use Brookline
            //"http://goboston2030.org/arinas-trip/",
            "http://goboston2030.org/marahs-trip-the-reluctant-driver/", //Dorchester to Roxbury, here use Dorchester
            "http://goboston2030.org/angelas-trip/", //Jamaica Plain to Mission Hill, here use Jamaica Plain
            "http://goboston2030.org/matts-trip/", //North End
            "http://goboston2030.org/victors-trip/", //East Boston to Fenway, here use East Boston
            "http://goboston2030.org/brees-trip/", //West Roxbury to Fenway, here use Fenway
            "http://goboston2030.org/juans-trip/" //Cambridge to Roxbury, here use Roxbury
        ];
        var loc = ["Roxbury", "Allston", "Brookline", "Dorchester", "Jamaica Plain", "North End", "East Boston", "Fenway", "Roxbury"]
        var people = ["Mash", "Jeffrey", "Jenn", "Marah", "Angela", "Matt", "Victor", "Bree", "Juan"];
        var keywords = [["parking", "walking", "stops", "butterfly", "line"],
                        ["phones", "signal", "time", "design", "avenues"],
                        ["biking", "routes", "streets", "public transportation", "separated"],
                        ["hours", "reserved spots", "copenhagen", "rhode", "kingston"],
                        ["biking", "drivers", "lanes", "parking", "cycling"],
                        ["streets", "hubway bike", "parking", "commute", "cars"],
                        ["trips", "services", "vans", "improving", "ferries"],
                        ["bus", "walking", "line", "hill", "option"]];

        var vm = new Vue({
            el: "#view",
            data: {
                cloudy: false,
                image_url: "images/allston.png"
            },
            methods: {
                dosomething: function () {
                    this.cloudy=false;
                    $("#viewer").attr("src", "welcome.html");
                }
            }
        })

        var map = L.map('map').setView([42.353157, -71.110664], 13);
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            maxZoom: 18,
            id: 'mapbox.light'
        }).addTo(map);

        function onEachFeature(feature, layer) {
          if (feature.properties && feature.properties.popupContent) {
            var popupContent = feature.properties.popupContent;

          }

          var AllstonIcon = L.icon({
        		iconUrl: 'AllstonIcon.jpg',
        		iconSize: [70, 60],
        		iconAnchor: [16, 37],
        		popupAnchor: [0, -28]
        	});

          var NorthEndIcon = L.icon({
        		iconUrl: 'NorthEndIcon.jpg',
        		iconSize: [60, 50],
        		iconAnchor: [16, 37],
        		popupAnchor: [0, -28]
          });

          var BrooklineIcon = L.icon({
            iconUrl: 'BrooklineIcon.jpg',
            iconSize: [60, 50],
            iconAnchor: [16, 37],
            popupAnchor: [0, -28]
          });

          var DorchesterIcon = L.icon({
            iconUrl: 'DorchesterIcon.jpg',
            iconSize: [75, 65],
            iconAnchor: [16, 37],
            popupAnchor: [0, -28]
          });

          var JamaicaIcon = L.icon({
            iconUrl: 'JamaicaIcon.jpg',
            iconSize: [75, 65],
            iconAnchor: [16, 37],
            popupAnchor: [0, -28]
          });

          var RoxburyIcon = L.icon({
            iconUrl: 'RoxburyIcon.jpg',
            iconSize: [75, 65],
            iconAnchor: [16, 37],
            popupAnchor: [0, -28]
          });

          var EastBostonIcon = L.icon({
            iconUrl: 'EastBostonIcon.jpg',
            iconSize: [75, 65],
            iconAnchor: [16, 37],
            popupAnchor: [0, -28]
          });

          var FenwayIcon = L.icon({
            iconUrl: 'FenwayIcon.jpg',
            iconSize: [75, 65],
            iconAnchor: [16, 37],
            popupAnchor: [0, -28]
          });

          var popup1 = L.marker([42.35969, -71.12841], {icon: AllstonIcon}).addTo(map);;
          var popup2 = L.marker([42.365156, -71.054741], {icon: NorthEndIcon}).addTo(map);;
          var popup3 = L.marker([42.3441, -71.0957], {icon: FenwayIcon}).addTo(map);;
          var popup4 = L.marker([42.3145, -71.1209], {icon: JamaicaIcon}).addTo(map);;
          var popup5 = L.marker([42.3011, -71.0743], {icon: DorchesterIcon}).addTo(map);;
          var popup6 = L.marker([42.3302, -71.0940], {icon: RoxburyIcon}).addTo(map);;
          var popup7 = L.marker([42.3302, -71.1514], {icon: BrooklineIcon}).addTo(map);;
          var popup8 = L.marker([42.3794, -71.0248], {icon: EastBostonIcon}).addTo(map);;

          layer.bindPopup(popupContent);
          layer.on('click', function(e) {
              vm.cloudy = true;
              vm.image_url = "images/"+ popupContent + ".png";
              $("#viewer").attr("src", story_urls[loc.indexOf(popupContent)]);
          });
        }


        L.geoJSON([freeBus], {

          style: function (feature) {
            return feature.properties && feature.properties.style;
          },

          onEachFeature: onEachFeature,

        }).addTo(map);


    </script>
</body>
</html>
